{"pageProps":{"slug":"20221208-2252xx-wsl","content":"\r\n# 어느 날 갑자기 docker desktop에서 돌리는 k8s가 안켜지고 멍을 때린다.\r\n\r\n어? 왜 이럼??\r\n\r\n처음엔 docker desktop을 clean하게 uninstall 해줬다.\r\n\r\nAppData에 들어있는거 local 머시기 등등에 들어있는거 싹다 지우고 다시 docker desktop을 install했지만..\r\n\r\n결과는 똑같았다.\r\n\r\n# 아 뭔데!!\r\n\r\n그래서 대체 뭔 짓을 하는지 궁금해서 대충 찾아서 나온 docker 관련 로그 파일이 있다는 곳을 찾아서 봤지만..\r\n\r\n뭐가 없다.\r\n\r\n그래서 혹시 모르니 다 지워버리자!! 라는 마음으로 이것저것 지워대고 다시 시작했지만 쥐뿔도 안먹힌다.\r\n\r\n그러다 docker desktop 설치할때 hyper-v 대신에 wsl2로 docker를 켜세요 라는 option을 주었던 것이 기억났다.\r\n\r\n# 내 심증은 널 향하고 있어 WSL\r\n\r\n일단 내가 사용 중인 wsl distro부터 생각해보니... 20.04다.\r\n\r\n에잇 하는 김에 최신쓰자 라는 생각으로 22.04를 설치하려 했는데 시작부터 마소 앱스토어에서 받는게 안좋은건지 다운로드가 멈춘것 처럼 보이고 난리가 난다.\r\n\r\n여튼 어찌어찌 20.04를 지우고 22.04를 앱스토어에서 설치했다.\r\n\r\n# 그건 니 생각이고\r\n\r\n커맨드라인을 열어서 다음의 명령어로 내 wsl에는 뭐가 있나 살펴보았다.\r\n\r\n```shell\r\nwsl --list --verbose --all\r\n```\r\n\r\n```plain\r\nC:\\Users\\trazy>wsl --list --verbose --all\r\n  NAME                   STATE           VERSION\r\n* Ubuntu-20.04           Running         2\r\n  Ubuntu-22.04           Running         2\r\n```\r\n\r\n하니.. 20.04가 남아있네? 하... 그래도 뭐 새로 깔은 22.04는 잘 있는거 같으니 다음의 명령으로 20.04를 빼버리고 22.04를 기본으로 바꿔주었다.\r\n\r\n```shell\r\nwsl --unregister Ubuntu-20.04\r\nwsl --set-default Ubuntu-22.04\r\n```\r\n\r\n음 이제 뭔가 만족스럽군. 그리고 docker desktop을 다시 설치했지만.. 그것마저도 날 배반했다.\r\n\r\ndocker는 잘 켜지지만 k8s는 여전히 starting 이라는 메시지만 나올뿐 켜질 기미가 보이질 않는다.\r\n\r\n# 아 대체 왜 그러냐고!!!\r\n\r\n이게 대체 뭔 일인가 해서 22.04로 들어가보았다.\r\n\r\n뭔 이상이 없는거 같다.\r\n\r\ndocker가 깔리고 나니 wsl distro에 docker-desktop 이랑 docker-desktop-data 가 추가된게 보인다.\r\n\r\n```plain\r\nC:\\Users\\trazy>wsl --list --verbose --all\r\n  NAME                   STATE           VERSION\r\n* Ubuntu-22.04           Running         2\r\n  docker-desktop-data    Running         2\r\n  docker-desktop         Running         2\r\n```\r\n\r\ndocker-desktop-data 로 들어가니 뭔 이상한 메시지가 보이면서 창이 닫혀버린다. 여기가 아닌가?\r\n\r\n해서 이번엔 docker-desktop으로 들어갔다.\r\n\r\n뭐 들어간건 이상이 없고..\r\n\r\n내 기억에 docker desktop으로 k8s를 켜면 이녀석이 k8s 관련된 이미지를 pull 해오는 것이 기억났다.\r\n\r\n너 혹시 인터넷이 안되니? 라는 마음으로 wget으로 google.com을 때려보니.. 모른다고 한다.\r\n\r\n아놔.. 뭔데? 라는 마음으로 google.com을 몰라? dns nameserver 설정이 미친건가? 하고 /etc/resolv.conf를 보니..\r\n\r\n172.뭐시기 하는 이상한 걸로 되어있다. 이건 뭐야? 라는 마음으로 8.8.8.8로 바꾸고 wsl을 재시작했다.\r\n\r\n```plain\r\nwsl --shutdown\r\n```\r\n\r\n그리고 다시 켜지고 나서 들어가니 resolv.conf가 원래대로 돌아가 있었다.\r\n\r\n어? 뭐여?\r\n\r\n하고 찾아보니 wsl 설정에서 `자동 생성하지 마세요` 라는 걸 해줘야 이것이 새로 만들어지지 않는다고 한다.\r\n\r\n그래서 /etc/wsl.conf 파일에 위에 본 것에 나온대로 다음의 내용을 넣어주었다.\r\n\r\n```plain\r\n[network]\r\ngenerateResolvConf = false\r\n```\r\n\r\n그리고 wsl을 다시 켜니 파일이 그대로 있는 것.. 은 개뿔 다른 파일로 바뀌더라.\r\n\r\n그래서 찾아보니 다음의 명령으로 읽기 전용으로 바꾸면 된다고 하는 희망적 메시지를 발견했다.\r\n\r\n```shell\r\nchattr +i /etc/resolv.conf\r\n# docker desktop에서는 chattr가 안되서 다음으로 했다.\r\nchmod -w /etc/resolv.conf\r\n```\r\n\r\n오... 뭔가 잘 되었다.\r\n\r\n그 와중 계속해서 wsl이 이상한데? 다시 켤까 라고 물어보고 있던 docker를 다시 켜보니..\r\n\r\n잘 되었다.\r\n\r\n# 이거 전에도 당한거 같은데?\r\n\r\nWSL의 버그인가? 아니면 docker-desktop의 문제인가?\r\n\r\n여튼.. 같은 문제에 또 당하지 않도록 기록을 남긴다.\r\n","frontMatter":{"title":"WSL 왜 이러니!","datetime":"2022-12-08T22:52:00.000+09:00","description":"전에도 이걸로 뒤통수 맞았었던거 같은데?","tags":["wsl"]},"associatedPosts":[],"relatedByTags":[]},"__N_SSG":true}